<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mariscos GÃ³mez - Sistema de Inventario</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
    <!-- Pantalla de Login -->
    <div id="loginScreen">
        <div class="login-container">
            <h2 style="text-align: center; margin-bottom: 30px; color: #2c3e50;">ğŸ¦ Acceso al Sistema</h2>
            <form id="loginForm">
                <div class="form-group">
                    <label for="username">ğŸ‘¤ Usuario:</label>
                    <input type="text" id="username" required placeholder="Ingresa tu usuario">
                </div>
                <div class="form-group">
                    <label for="password">ğŸ”’ ContraseÃ±a:</label>
                    <input type="password" id="password" required placeholder="Ingresa tu contraseÃ±a">
                </div>
                <button type="submit" class="btn btn-success" style="width: 100%;">ğŸš€ Iniciar SesiÃ³n</button>
            </form>
            
            <!-- <div class="login-info">
                <strong>ğŸ“ Credenciales de acceso:</strong><br>
                <strong>Usuarios Disponibles:</strong> Gomez, Jafeth, Diana<br>
            </div>-->
        </div>
    </div>

    <!-- Sistema Principal -->
    <div id="mainSystem" class="hidden">
        <div class="user-info" id="userInfo">
            ğŸ‘¤ Usuario: <span id="currentUser"></span>
            <button class="logout-btn" id="logoutBtn">ğŸšª Salir</button>
        </div>

        <div class="container">
            <!-- Monitor de Almacenamiento -->
            <div class="storage-monitor" id="storageMonitor">
                <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap;">
                    <span>ğŸ’¾ Uso de Almacenamiento: <span id="storageUsed">0</span>KB / <span id="storageLimit">5120</span>KB</span>
                    <span id="storagePercent">0%</span>
                </div>
                <div class="storage-bar">
                    <div class="storage-fill" id="storageFill"></div>
                </div>
                <div style="font-size: 0.8em; opacity: 0.9;">
                    ğŸ“Š <span id="totalRecords">0</span> registros totales â€¢ 
                    ğŸ·ï¸ <span id="totalProducts">0</span> productos â€¢ 
                    ğŸ“„ <span id="totalInvoices">0</span> facturas
                </div>
            </div>

            <div class="header">
                <h1>ğŸ¦ Mariscos GÃ³mez</h1>
                <p>Sistema de Inventario y FacturaciÃ³n</p>
                <div class="github-badge">ğŸ“± Jafeth CastellÃ³n GÃ³mez - Optimizado</div>
            </div>

            <div class="tabs">
                <button class="tab active" data-tab="inventory">ğŸ“¦ Inventario</button>
                <button class="tab" data-tab="add-product">â• Agregar Producto</button>
                <button class="tab" data-tab="invoice">ğŸ§¾ FacturaciÃ³n</button>
                <button class="tab" data-tab="reports">ğŸ“Š Reportes</button>
                <button class="tab" data-tab="sales-reports">ğŸ“ˆ Reportes de Ventas</button>
                <button class="tab" data-tab="maintenance">ğŸ”§ Mantenimiento</button>
            </div>

            <!-- Inventario -->
            <div id="inventory" class="content">
                <h2>ğŸ“¦ Inventario de Productos</h2>
                <input type="text" class="search-box" id="searchProducts" placeholder="ğŸ” Buscar productos...">
                
                <!-- PaginaciÃ³n de productos -->
                <div class="pagination" id="productsPagination" style="display: none;">
                    <button onclick="changeProductPage(-1)">Â« Anterior</button>
                    <span id="productPageInfo">PÃ¡gina 1 de 1</span>
                    <button onclick="changeProductPage(1)">Siguiente Â»</button>
                </div>

                <div id="productGrid" class="product-grid"></div>
            </div>

            <!-- Agregar Producto -->
            <div id="add-product" class="content hidden">
                <h2>â• Agregar Nuevo Producto</h2>
                <form id="addProductForm">
                    <div class="form-group">
                        <label for="productName">Nombre del Producto:</label>
                        <input type="text" id="productName" required placeholder="Ej: Camarones Frescos">
                    </div>
                    <div class="form-group">
                        <label for="productCategory">CategorÃ­a:</label>
                        <select id="productCategory" required>
                            <option value="">Seleccionar categorÃ­a</option>
                            <option value="Pescados">Pescados</option>
                            <option value="Mariscos">Mariscos</option>
                            <option value="CrustÃ¡ceos">CrustÃ¡ceos</option>
                            <option value="Moluscos">Moluscos</option>
                            <option value="Productos Preparados">Productos Preparados</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="productPrice">Precio por Unidad/Kg (â‚¡):</label>
                        <input type="number" id="productPrice" step="0.01" required placeholder="0.00">
                    </div>
                    <div class="form-group">
                        <label for="productStock">Stock Inicial:</label>
                        <input type="number" id="productStock" required placeholder="0">
                    </div>
                    <div class="form-group">
                        <label for="productUnit">Unidad de Medida:</label>
                        <select id="productUnit" required>
                            <option value="">Seleccionar unidad</option>
                            <option value="Kg">Kilogramos</option>
                            <option value="Paquete">Paquete</option>
                            <option value="Pza">Piezas</option>
                            <option value="Caja">Cajas</option>
                            <option value="Bolsa">Bolsa</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-success">âœ… Agregar Producto</button>
                </form>
            </div>

            <!-- FacturaciÃ³n -->
            <div id="invoice" class="content hidden">
                <h2>ğŸ§¾ Sistema de FacturaciÃ³n</h2>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div>
                        <h3>Datos del Cliente</h3>
                        <div class="form-group">
                            <label for="clientName">Nombre del Cliente:</label>
                            <input type="text" id="clientName" placeholder="Nombre completo">
                        </div>
                        <div class="form-group">
                            <label for="clientPhone">TelÃ©fono:</label>
                            <input type="tel" id="clientPhone" placeholder="0000-0000">
                        </div>
                        <div class="form-group">
                            <label for="clientAddress">DirecciÃ³n:</label>
                            <input type="text" id="clientAddress" placeholder="DirecciÃ³n completa">
                        </div>
                    </div>
                    <div>
                        <h3>Seleccionar Productos</h3>
                        <div class="form-group">
                            <label for="invoiceProduct">Producto:</label>
                            <select id="invoiceProduct">
                                <option value="">Seleccionar producto</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="invoiceQuantity">Cantidad:</label>
                            <input type="number" id="invoiceQuantity" step="0.1" placeholder="0">
                        </div>
                        <button type="button" class="btn" id="addToInvoiceBtn">â• Agregar al Pedido</button>
                    </div>
                </div>
                
                <div class="invoice-section">
                    <h3>ğŸ“‹ Resumen del Pedido</h3>
                    <div id="invoiceItems"></div>
                    <div id="invoiceTotal" class="invoice-total">Total: â‚¡0.00</div>
                    <div class="action-buttons" style="text-align: center; margin-top: 20px;">
                        <button class="btn btn-success" id="generatePDFBtn">ğŸ“„ Generar Factura PDF</button>
                        <button class="btn btn-danger" id="clearInvoiceBtn">ğŸ—‘ï¸ Limpiar Pedido</button>
                    </div>
                </div>
            </div>

            <!-- Reportes -->
            <div id="reports" class="content hidden">
                <h2>ğŸ“Š Reportes y EstadÃ­sticas</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalProductsStat">0</div>
                        <div>Total Productos</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="lowStockProductsStat">0</div>
                        <div>Stock Bajo</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">â‚¡<span id="totalInventoryValueStat">0</span></div>
                        <div>Valor Inventario</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalInvoicesStat">0</div>
                        <div>Facturas Generadas</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">â‚¡<span id="totalSalesStat">0</span></div>
                        <div>Total Vendido</div>
                    </div>
                </div>
            </div>

            <!-- Reportes de Ventas -->
            <div id="sales-reports" class="content hidden">
                <h2>ğŸ“ˆ Reportes Detallados de Ventas</h2>
                
                <div class="date-filter">
                    <div class="form-group">
                        <label for="startDate">ğŸ“… Fecha Inicio:</label>
                        <input type="date" id="startDate">
                    </div>
                    <div class="form-group">
                        <label for="endDate">ğŸ“… Fecha Final:</label>
                        <input type="date" id="endDate">
                    </div>
                    <div class="action-buttons">
                        <button class="btn" id="filterSalesBtn">ğŸ” Filtrar</button>
                        <button class="btn btn-warning" id="clearFilterBtn">ğŸ—‘ï¸ Limpiar</button>
                    </div>
                </div>

                <div class="action-buttons" style="margin-bottom: 20px;">
                    <button class="btn btn-success" id="exportPDFBtn">ğŸ“„ Exportar PDF</button>
                    <button class="btn btn-success" id="exportExcelBtn">ğŸ“Š Exportar Excel</button>
                    <button class="btn" id="printReportBtn">ğŸ–¨ï¸ Imprimir</button>
                </div>

                <div class="product-card">
                    <h3>ğŸ“Š Resumen del PerÃ­odo</h3>
                    <p><strong>Total de Ventas:</strong> â‚¡<span id="periodTotalSales">0.00</span></p>
                    <p><strong>Facturas en el PerÃ­odo:</strong> <span id="periodInvoiceCount">0</span></p>
                    <p><strong>Promedio por Factura:</strong> â‚¡<span id="averageInvoiceAmount">0.00</span></p>
                </div>

                <!-- PaginaciÃ³n para tabla de ventas -->
                <div class="pagination" id="salesPagination" style="display: none;">
                    <button onclick="changeSalesPage(-1)">Â« Anterior</button>
                    <span id="salesPageInfo">PÃ¡gina 1 de 1</span>
                    <button onclick="changeSalesPage(1)">Siguiente Â»</button>
                </div>

                <div class="table-wrapper">
                    <table class="sales-table" id="salesTable">
                        <thead>
                            <tr>
                                <th>ğŸ“„ # Factura</th>
                                <th>ğŸ“… Fecha</th>
                                <th>ğŸ• Hora</th>
                                <th>ğŸ‘¤ Cliente</th>
                                <th>ğŸ“ TelÃ©fono</th>
                                <th>ğŸ’° Total</th>
                                <th>ğŸ” Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="salesTableBody">
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Nueva secciÃ³n de Mantenimiento -->
            <div id="maintenance" class="content hidden">
                <div style="margin-bottom:15px; display:flex; gap:10px; flex-wrap:wrap;">
                    <button class="btn btn-info" id="btnSyncFirebase" onclick="syncWithFirebase()">â˜ï¸ Sincronizar con Firebase</button>
                    <button class="btn btn-success" id="btnMigrateFirebase" onclick="migrateToFirebase()">ğŸ“¤ Migrar datos locales a Firebase</button>
                </div>

                <h2>ğŸ”§ Mantenimiento del Sistema</h2>
                
                <div class="maintenance-section">
                    <h3>ğŸ“Š Estado del Sistema</h3>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number" id="storageUsagePercent">0%</div>
                            <div>Almacenamiento Usado</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="oldRecordsCount">0</div>
                            <div>Registros Antiguos (>6 meses)</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="systemPerformance">100%</div>
                            <div>Rendimiento del Sistema</div>
                        </div>
                    </div>
                </div>

                <div class="maintenance-section">
                    <h3>âš ï¸ Alertas del Sistema</h3>
                    <div id="systemAlerts">
                        <!-- Las alertas se mostrarÃ¡n aquÃ­ dinÃ¡micamente -->
                    </div>
                </div>

                <div class="maintenance-section">
                    <h3>ğŸ§¹ Limpieza AutomÃ¡tica</h3>
                    <p>El sistema puede limpiar automÃ¡ticamente datos antiguos para optimizar el rendimiento.</p>
                    <div class="maintenance-buttons">
                        <button class="btn btn-warning" onclick="archiveOldData()">ğŸ“¦ Archivar Datos Antiguos</button>
                        <button class="btn btn-success" onclick="exportAllData()">ğŸ’¾ Backup Completo</button>
                        <button class="btn btn-info" onclick="optimizeStorage()">âš¡ Optimizar Almacenamiento</button>
                        <button class="btn btn-danger" onclick="clearOldInvoices()">ğŸ—‘ï¸ Limpiar Facturas Antiguas</button>
                    </div>
                </div>

                <div class="maintenance-section">
                    <h3>ğŸ“ˆ ConfiguraciÃ³n de LÃ­mites</h3>
                    <div class="form-group">
                        <label for="maxInvoices">MÃ¡ximo de Facturas a Conservar:</label>
                        <input type="number" id="maxInvoices" value="1000" min="100" max="10000">
                        <small>Recomendado: 1000-2000 facturas</small>
                    </div>
                    <div class="form-group">
                        <label for="autoCleanupEnabled">
                            <input type="checkbox" id="autoCleanupEnabled"> 
                            Activar limpieza automÃ¡tica
                        </label>
                        <small>Limpia automÃ¡ticamente cuando el almacenamiento supera el 80%</small>
                    </div>
                    <button class="btn btn-success" onclick="saveMaintenanceConfig()">ğŸ’¾ Guardar ConfiguraciÃ³n</button>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script src="firebase-integration.js"></script>
</body>

</html>
